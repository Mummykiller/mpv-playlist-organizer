<!DOCTYPE html>
<html>
<head>
    <title>MPV Playlist Organizer</title>
    <style>
        :root {
            /* Slick, Modern & Dark Palette */
            --bg-color: #111214;
            --surface-color: #1d1f23;
            --surface-hover-color: #2c2e33;
            --border-color: #33363b;
            --text-primary: #e1e1e1;
            --text-secondary: #9e9e9e;
            --accent-primary: #5865f2; /* A modern, vibrant blue/purple */
            --accent-primary-hover: #4f5bda;
            --accent-negative: #ed4245; /* A modern, vibrant red */
            --accent-negative-hover: #da3739;
            --accent-positive: #43b581;
            --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --border-radius: 6px;
            --transition-speed: 0.15s;
        }

        html {
            background-color: transparent;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: var(--font-sans);
            width: 280px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            border-radius: 12px;
            overflow: hidden;
            box-sizing: border-box;
        }

        h1 {
            font-size: 18px; /* Slightly larger for prominence */
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            text-align: center;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }
        h1 + .control-group { margin-top: 16px; } /* Add space after header */

        .control-group {
            display: flex;
            gap: 8px;
        }

        input, select {
            flex-grow: 1;
            box-sizing: border-box;
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: var(--border-radius);
            padding: 10px;
            font-size: 14px;
            transition: all var(--transition-speed) ease;
            min-width: 0; /* Allows the input to shrink below its default minimum size in a flex container */
        }

        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%239e9e9e' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            -webkit-appearance: none;
            appearance: none;
        }

        input:hover, select:hover {
            background-color: var(--surface-hover-color);
            border-color: #555;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* Subtle lift on hover */
        }

        input:focus-visible, select:focus-visible {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 2px var(--accent-primary);
            box-shadow: 0 0 0 2px rgba(88, 101, 242, 0.3); /* Softer focus ring */
        }

        input::placeholder {
            color: var(--text-secondary);
        }

        button {
            color: #fff;
            flex-shrink: 0;
            border: none;
            border-radius: var(--border-radius);
            padding: 10px 14px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* Subtle shadow for depth */
        }

        button:disabled {
            background-color: #33363b;
            cursor: not-allowed;
        }
        #btn-create-folder {
            background-color: var(--accent-primary);
            color: white; /* Ensure good contrast */
        }
        #btn-create-folder:hover {
            background-color: var(--accent-primary-hover);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Lift on hover */
        }

        #btn-remove-folder {
            background-color: var(--accent-negative);
            color: white; /* Ensure good contrast */
        }
        #btn-remove-folder:hover {
            background-color: var(--accent-negative-hover);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        #btn-show-controller {
            margin-top: 16px; /* More space above */
            background-color: var(--accent-positive);
        }
        #btn-show-controller:hover {
            /* A slightly darker version of the positive accent */
            background-color: #3da874;
        }

        #status-message {
            font-size: 13px;
            text-align: center;
            padding-top: 8px; /* Add some padding above */
            min-height: 1.2em;
            transition: color 0.2s ease;
        }

        /* --- Styles for the Mini Controller View --- */
        #mini-controller-view {
            /* This is set to flex in popup.js when active */
            flex-direction: column;
            gap: 12px; /* A bit less gap for a tighter look */
        }

        #mini-controller-actions {
            display: flex;
            gap: 8px;
            justify-content: space-between; /* Distribute buttons evenly */
        }

        #mini-controller-actions button {
            flex-grow: 1; /* Make buttons take up equal space */
            padding: 8px; /* Tighter padding for icon buttons */
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--surface-color);
        }

        #mini-controller-actions button:hover {
            background-color: var(--surface-hover-color);
        }

        /* Specific colors for key actions */
        #mini-controller-actions #btn-mini-play,
        #mini-controller-actions #btn-mini-add.url-detected {
            background-color: var(--accent-positive);
        }
        #mini-controller-actions #btn-mini-play:hover,
        #mini-controller-actions #btn-mini-add.url-detected:hover {
            background-color: #3da874; /* Darker green */
        }

        #mini-controller-actions button svg {
            stroke: var(--text-primary);
        }

        #mini-item-count-container {
            display: flex;
            align-items: center;
            gap: 6px;
            background-color: var(--surface-color);
            padding: 0 10px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        /* Style for the secondary action button */
        .secondary-action {
            background-color: var(--accent-primary);
            border: none;
            color: white; /* Ensure best contrast */
            font-weight: 600;
            width: 100%;
            margin-top: 8px; /* Give it a bit more space */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .secondary-action:hover {
            background-color: var(--accent-primary-hover);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Lift on hover */
        }

        /* Additional styles for folder management in mini-controller */
        #mini-folder-management-controls {
            display: none; /* Hidden by default */
            flex-direction: column;
            gap: 8px;
            padding: 12px;
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            margin-top: 8px;
        }

        /* Styles for the buttons inside the mini folder manager for consistency */
        #mini-folder-management-controls #btn-mini-create-folder {
            background-color: var(--accent-primary);
        }
        #mini-folder-management-controls #btn-mini-create-folder:hover {
            background-color: var(--accent-primary-hover);
        }
        #mini-folder-management-controls #btn-mini-remove-folder {
            width: 100%;
            background-color: var(--accent-negative);
        }
        #mini-folder-management-controls #btn-mini-remove-folder:hover {
            background-color: var(--accent-negative-hover);
        }
    </style>
</head>
<body>
    <h1>MPV Playlist Organizer</h1>

    <!-- View 1: Mini Controller (shown when on-page UI is minimized) -->
    <div id="mini-controller-view" style="display: none;">
        <div class="control-group">
            <select id="mini-folder-select" title="Select active folder" style="flex-grow: 1;"></select>
            <button id="btn-mini-manage-folders" title="Manage Folders" style="flex-shrink: 0; padding: 8px; background-color: var(--surface-color);">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            </button>
            <div id="mini-item-count-container" title="Items in playlist" style="flex-shrink: 0;">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
                <span id="mini-item-count">0</span>
            </div>
        </div>
        <div id="mini-controller-actions">
            <button id="btn-mini-add" title="Add Detected URL">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            </button>
            <button id="btn-mini-play" title="Play Playlist">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
            </button>
            <button id="btn-mini-clear" title="Clear Playlist">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
            </button>
            <button id="btn-mini-close-mpv" title="Close MPV">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
        </div>
        <div id="mini-folder-management-controls">
            <div class="control-group">
                <input type="text" id="mini-new-folder-name" placeholder="New folder name...">
                <button id="btn-mini-create-folder">Create</button>
            </div>
            <div class="control-group" style="margin-top: 12px;">
                <button id="btn-mini-remove-folder">Remove Selected Folder</button>
            </div>
        </div>
        <button id="btn-show-on-page-controller" class="secondary-action">Show On-Page Controller</button>
    </div>

    <!-- View 2: Folder Management (default view) -->
    <div id="folder-management-view" style="display: none;">
        <div class="control-group">
            <input type="text" id="new-folder-name" placeholder="Create new folder...">
            <button id="btn-create-folder">Create</button>
        </div>
        <div class="control-group" style="margin-top: 12px;">
            <select id="remove-folder-select">
                <option value="">Select folder to remove...</option>
            </select>
            <button id="btn-remove-folder" disabled>Remove</button>
        </div>
    </div>

    <div id="status-message"></div>
    <script src="popup.js"></script>
</body>
</html>